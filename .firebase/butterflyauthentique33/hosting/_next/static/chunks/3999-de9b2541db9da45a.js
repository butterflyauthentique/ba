"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3999],{3999:(e,r,a)=>{a.d(r,{A:()=>g,AuthProvider:()=>u});var t=a(5155),o=a(2115),s=a(5404),i=a(5317),n=a(6104),c=a(3568),l=a(6734);let d=(0,o.createContext)(void 0);function u(e){let{children:r}=e,[a,u]=(0,o.useState)(null),[g,m]=(0,o.useState)(null),[y,f]=(0,o.useState)(!0),[h,p]=(0,o.useState)(null),w=async e=>{var r;let a=await (0,i.x7)((0,i.H9)(n._f.users,e.uid));if(a.exists()){let r=a.data();return r.emailVerified!==e.emailVerified?(await (0,i.setDoc)((0,i.H9)(n._f.users,e.uid),{emailVerified:e.emailVerified,updatedAt:(0,i.serverTimestamp)()},{merge:!0}),{...r,emailVerified:e.emailVerified}):{...r,id:e.uid}}let t={id:e.uid,email:e.email,name:e.displayName||e.email.split("@")[0],role:"user",isActive:!0,emailVerified:e.emailVerified,createdAt:(0,i.serverTimestamp)(),updatedAt:(0,i.serverTimestamp)(),provider:"email",providerId:(null==(r=e.providerData[0])?void 0:r.providerId)||"email"};return await (0,i.setDoc)((0,i.H9)(n._f.users,e.uid),t),t};(0,o.useEffect)(()=>(0,s.hg)(n.j2,async e=>{if(m(e),e)try{let r=await w(e);u(r)}catch(e){console.error("Error converting Firebase user:",e),u(null)}else u(null);f(!1)}),[]);let b=async(e,r)=>{try{if(f(!0),p(null),!(await (0,s.x9)(n.j2,e,r)).user.emailVerified){await (0,s.CI)(n.j2),p((0,l.dY)("auth/email-not-verified"));return}c.Ay.success("Welcome back!")}catch(e){throw console.error("Sign in error:",e),e.code?p((0,l.dY)(e.code)):p((0,l.dY)("auth/network-request-failed")),e}finally{f(!1)}},v=async(e,r,a)=>{try{f(!0),p(null);let t=e.split("@")[1];if(!["gmail.com","yahoo.com","hotmail.com","outlook.com"].includes(t))return void p((0,l.dY)("auth/invalid-email"));let o=await (0,s.eJ)(n.j2,e,r);await (0,s.r7)(o.user,{displayName:a}),await (0,s.gA)(o.user,{url:"".concat(window.location.origin,"/verify-email?email=").concat(encodeURIComponent(e)),handleCodeInApp:!1})}catch(e){throw console.error("Sign up error:",e),e.code?p((0,l.dY)(e.code)):p((0,l.dY)("auth/network-request-failed")),e}finally{f(!1)}},A=async()=>{try{await (0,s.CI)(n.j2),c.Ay.success("Signed out successfully")}catch(e){console.error("Sign out error:",e),c.Ay.error("Error signing out")}},E=async e=>{try{f(!0),p(null),await (0,s.J1)(n.j2,e,{url:"".concat(window.location.origin,"/reset-password-confirm"),handleCodeInApp:!1}),c.Ay.success("Password reset email sent! Check your inbox")}catch(e){throw console.error("Reset password error:",e),e.code?p((0,l.dY)(e.code)):p((0,l.dY)("auth/network-request-failed")),e}finally{f(!1)}},x=async(e,r)=>{try{f(!0),p(null),await (0,s.R4)(n.j2,e,r),c.Ay.success("Password reset successfully! You can now sign in with your new password")}catch(e){throw console.error("Confirm password reset error:",e),e.code?p((0,l.dY)(e.code)):p((0,l.dY)("auth/network-request-failed")),e}finally{f(!1)}},I=async()=>{if(g)try{f(!0),p(null),await (0,s.gA)(g,{url:"".concat(window.location.origin,"/verify-email?email=").concat(encodeURIComponent(g.email)),handleCodeInApp:!1}),c.Ay.success("Verification email sent! Check your inbox and spam folder")}catch(e){throw console.error("Send verification email error:",e),e.code?p((0,l.dY)(e.code)):p((0,l.dY)("auth/network-request-failed")),e}finally{f(!1)}},_=async e=>{try{f(!0),p(null),await (0,s.sv)(n.j2,e),c.Ay.success("Email verified successfully!"),g&&await g.reload()}catch(e){throw console.error("Confirm email verification error:",e),e.code?p((0,l.dY)(e.code)):p((0,l.dY)("auth/network-request-failed")),e}finally{f(!1)}},N=async e=>{if(g&&a)try{f(!0),p(null),e.name&&await (0,s.r7)(g,{displayName:e.name}),await (0,i.setDoc)((0,i.H9)(n._f.users,g.uid),{...e,updatedAt:(0,i.serverTimestamp)()},{merge:!0}),u({...a,...e}),c.Ay.success("Profile updated successfully")}catch(e){throw console.error("Update profile error:",e),p((0,l.dY)("auth/network-request-failed")),e}finally{f(!1)}},R=async()=>{if(g)try{await g.reload();let e=await w(g);u(e)}catch(e){console.error("Refresh user error:",e)}};return(0,t.jsx)(d.Provider,{value:{user:a,firebaseUser:g,loading:y,authError:h,setAuthError:p,signIn:b,signUp:v,signOut:A,resetPassword:E,confirmPasswordReset:x,sendVerificationEmail:I,confirmEmailVerification:_,updateUserProfile:N,refreshUser:R},children:r})}function g(){let e=(0,o.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6104:(e,r,a)=>{a.d(r,{IG:()=>g,_f:()=>m,db:()=>u,j2:()=>d,jU:()=>y});var t=a(3915),o=a(5404),s=a(5317),i=a(7505),n=a(9434);let c={apiKey:"AIzaSyBTZwEHiG_KmjmZY1wXW3Xane8F4pUqq_E",authDomain:"butterflyauthentique33.firebaseapp.com",projectId:"butterflyauthentique33",storageBucket:"butterflyauthentique33.firebasestorage.app",messagingSenderId:"147808797895",appId:"1:147808797895:web:5013c06442c7063f796ae2",measurementId:a(9509).env.NEXT_PUBLIC_GA_MEASUREMENT_ID},l=0===(0,t.Dk)().length?(0,t.Wp)(c):(0,t.Dk)()[0],d=(0,o.xI)(l),u=(0,s.aU)(l),g=(0,i.c7)(l);console.log("Firebase Config:",{projectId:c.projectId,authDomain:c.authDomain,storageBucket:c.storageBucket});let m={products:(0,s.rJ)(u,"products"),categories:(0,s.rJ)(u,"categories"),users:(0,s.rJ)(u,"users"),orders:(0,s.rJ)(u,"orders"),cart:(0,s.rJ)(u,"cart"),blog:(0,s.rJ)(u,"blog"),reviews:(0,s.rJ)(u,"reviews"),addresses:(0,s.rJ)(u,"addresses"),settings:(0,s.rJ)(u,"settings"),admins:(0,s.rJ)(u,"admins")},y={async create(e){try{console.log("\uD83D\uDE80 Creating new product...");let r=(0,s.H9)((0,s.rJ)(u,"temp")).id;console.log("Generated product ID:",r);let a=e.slug||(0,n.SV)(e.name,r);console.log("Generated slug:",a);let t={...e,id:r,slug:a,viewCount:0,purchaseCount:0,rating:0,reviews:0,createdAt:s.Dc.now(),updatedAt:s.Dc.now()};return console.log("\uD83D\uDCBE Saving to Firestore..."),await (0,s.setDoc)((0,s.H9)(m.products,r),t),console.log("✅ Product created successfully!"),t}catch(e){throw console.error("❌ Error creating product:",e),e}},async getById(e){try{console.log("\uD83D\uDD0D Getting product by ID or slug:",e);let r=(0,s.H9)(m.products,e),a=await (0,s.x7)(r);if(a.exists())return console.log("✅ Product found by ID"),{id:a.id,...a.data()};console.log("\uD83D\uDD0D Product not found by ID, searching by slug...");let t=(0,s.P)(m.products,(0,s._M)("slug","==",e),(0,s.AB)(1)),o=await (0,s.GG)(t);if(!o.empty){let e=o.docs[0];return console.log("✅ Product found by slug"),{id:e.id,...e.data()}}return console.log("❌ Product not found by ID or slug"),null}catch(e){return console.error("❌ Error getting product:",e),null}},async getAll(){try{console.log("\uD83D\uDD0D Getting all products...");let e=(0,s.P)(m.products,(0,s.My)("createdAt","desc")),r=await (0,s.GG)(e);return console.log("✅ Found ".concat(r.docs.length," products")),r.docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("❌ Error getting products:",e),[]}},async update(e,r){try{console.log("\uD83D\uDD04 Updating product:",e);let a=(0,s.H9)(m.products,e);await (0,s.setDoc)(a,{...r,updatedAt:s.Dc.now()},{merge:!0}),console.log("✅ Product updated successfully")}catch(e){throw console.error("❌ Error updating product:",e),e}},async delete(e){try{console.log("\uD83D\uDDD1️ Deleting product:",e),await (0,s.setDoc)((0,s.H9)(m.products,e),{}),console.log("✅ Product deleted successfully")}catch(e){throw console.error("❌ Error deleting product:",e),e}}}},6734:(e,r,a)=>{a.d(r,{Ay:()=>g,dY:()=>y});var t=a(5155),o=a(2115),s=a(5695),i=a(5339),n=a(1243),c=a(1284),l=a(4416),d=a(3904),u=a(2138);function g(e){let{error:r,onClose:a,onRetry:g,onResend:m}=e,y=(0,s.useRouter)(),[f,h]=(0,o.useState)(!1);if(!r)return null;let p=async e=>{h(!0);try{switch(e.action){case"navigate":e.href&&y.push(e.href);break;case"retry":g&&await g();break;case"resend":m&&await m();break;case"close":a()}}catch(e){console.error("Action error:",e)}finally{h(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:r.title}),(0,t.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,t.jsx)(l.A,{className:"h-5 w-5 text-gray-400"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full ".concat((()=>{switch(r.icon){case"error":default:return"bg-red-100";case"warning":return"bg-yellow-100";case"info":return"bg-blue-100"}})()," mb-4"),children:(()=>{switch(r.icon){case"error":default:return(0,t.jsx)(i.A,{className:"h-8 w-8 text-red-600"});case"warning":return(0,t.jsx)(n.A,{className:"h-8 w-8 text-yellow-600"});case"info":return(0,t.jsx)(c.A,{className:"h-8 w-8 text-blue-600"})}})()}),(0,t.jsx)("p",{className:"text-gray-600 leading-relaxed",children:r.message})]}),(0,t.jsx)("div",{className:"space-y-3",children:r.actions.map((e,r)=>(0,t.jsx)("button",{onClick:()=>p(e),disabled:f,className:"w-full py-3 px-6 rounded-xl font-semibold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 focus:ring-4 focus:outline-none ".concat((e=>{switch(e){case"primary":default:return"bg-rose-600 text-white hover:bg-rose-700 focus:ring-rose-200";case"secondary":return"bg-gray-100 text-gray-700 hover:bg-gray-200 focus:ring-gray-200";case"outline":return"bg-transparent text-rose-600 border-2 border-rose-600 hover:bg-rose-50 focus:ring-rose-200"}})(e.variant)),children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.A,{className:"h-5 w-5 animate-spin"}),"Loading..."]}):(0,t.jsxs)(t.Fragment,{children:[e.label,"navigate"===e.action&&(0,t.jsx)(u.A,{className:"h-5 w-5"})]})},r))})]})]})})}let m={USER_NOT_FOUND:{code:"auth/user-not-found",title:"Account Not Found",message:"No account exists with this email address. Would you like to create a new account?",icon:"info",actions:[{label:"Create Account",action:"navigate",href:"/register",variant:"primary"},{label:"Try Different Email",action:"close",variant:"secondary"}]},WRONG_PASSWORD:{code:"auth/wrong-password",title:"Incorrect Password",message:"The password you entered is incorrect. Would you like to reset your password?",icon:"warning",actions:[{label:"Reset Password",action:"navigate",href:"/forgot-password",variant:"primary"},{label:"Try Again",action:"close",variant:"secondary"}]},EMAIL_NOT_VERIFIED:{code:"auth/email-not-verified",title:"Email Not Verified",message:"Please verify your email address before signing in. Check your inbox and spam folder for the verification link.",icon:"warning",actions:[{label:"Resend Verification Email",action:"resend",variant:"primary"},{label:"Go to Sign In",action:"navigate",href:"/login",variant:"secondary"}]},USER_DISABLED:{code:"auth/user-disabled",title:"Account Disabled",message:"This account has been disabled. Please contact our support team for assistance.",icon:"error",actions:[{label:"Contact Support",action:"navigate",href:"/contact",variant:"primary"},{label:"Close",action:"close",variant:"secondary"}]},TOO_MANY_REQUESTS:{code:"auth/too-many-requests",title:"Too Many Attempts",message:"Too many failed sign-in attempts. Please wait a few minutes before trying again.",icon:"warning",actions:[{label:"Try Again Later",action:"close",variant:"primary"},{label:"Reset Password",action:"navigate",href:"/forgot-password",variant:"outline"}]},INVALID_EMAIL:{code:"auth/invalid-email",title:"Invalid Email",message:"Please enter a valid email address in the correct format.",icon:"warning",actions:[{label:"Try Again",action:"close",variant:"primary"}]},EMAIL_ALREADY_IN_USE:{code:"auth/email-already-in-use",title:"Email Already Registered",message:"An account with this email already exists. Would you like to sign in instead?",icon:"info",actions:[{label:"Sign In",action:"navigate",href:"/login",variant:"primary"},{label:"Try Different Email",action:"close",variant:"secondary"}]},WEAK_PASSWORD:{code:"auth/weak-password",title:"Password Too Weak",message:"Your password should be at least 6 characters long. Please choose a stronger password.",icon:"warning",actions:[{label:"Try Again",action:"close",variant:"primary"}]},OPERATION_NOT_ALLOWED:{code:"auth/operation-not-allowed",title:"Registration Disabled",message:"Email/password registration is currently disabled. Please contact support for assistance.",icon:"error",actions:[{label:"Contact Support",action:"navigate",href:"/contact",variant:"primary"},{label:"Close",action:"close",variant:"secondary"}]},NETWORK_ERROR:{code:"auth/network-request-failed",title:"Connection Error",message:"Unable to connect to our servers. Please check your internet connection and try again.",icon:"error",actions:[{label:"Retry",action:"retry",variant:"primary"},{label:"Close",action:"close",variant:"secondary"}]},GENERIC_ERROR:{code:"auth/generic-error",title:"Something Went Wrong",message:"An unexpected error occurred. Please try again or contact support if the problem persists.",icon:"error",actions:[{label:"Try Again",action:"retry",variant:"primary"},{label:"Contact Support",action:"navigate",href:"/contact",variant:"outline"}]}};function y(e){return({"auth/user-not-found":m.USER_NOT_FOUND,"auth/wrong-password":m.WRONG_PASSWORD,"auth/email-not-verified":m.EMAIL_NOT_VERIFIED,"auth/user-disabled":m.USER_DISABLED,"auth/too-many-requests":m.TOO_MANY_REQUESTS,"auth/invalid-email":m.INVALID_EMAIL,"auth/email-already-in-use":m.EMAIL_ALREADY_IN_USE,"auth/weak-password":m.WEAK_PASSWORD,"auth/operation-not-allowed":m.OPERATION_NOT_ALLOWED,"auth/network-request-failed":m.NETWORK_ERROR})[e]||m.GENERIC_ERROR}},9434:(e,r,a)=>{function t(e,r){let a=e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"").substring(0,100),t=r.substring(0,8);return"".concat(a,"-").concat(t)}function o(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function s(e){return/^[6-9]\d{9}$/.test(e.replace(/\D/g,""))}a.d(r,{B9:()=>o,BH:()=>s,SV:()=>t,k0:()=>i});let i=e=>new Promise((r,a)=>{if(document.querySelector('script[src="'.concat(e,'"]')))return void r();let t=document.createElement("script");t.src=e,t.async=!0,t.onload=()=>r(),t.onerror=()=>a(Error("Failed to load script: ".concat(e))),document.head.appendChild(t)})}}]);